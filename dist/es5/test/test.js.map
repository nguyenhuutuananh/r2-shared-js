{"version":3,"file":"test.js","sourceRoot":"","sources":["../../../test/test.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"path\";\n\nimport { timeStrToSeconds } from \"@models/media-overlay\";\nimport { Publication } from \"@models/publication\";\nimport { PublicationParsePromise } from \"@parser/publication-parser\";\nimport test from \"ava\";\nimport * as debug_ from \"debug\";\nimport * as filehound from \"filehound\";\nimport * as jsonDiff from \"json-diff\";\nimport { JSON as TAJSON } from \"ta-json-x\";\n\nimport {\n    initGlobalConverters_GENERIC,\n    initGlobalConverters_SHARED,\n} from \"../src/init-globals\";\n\ninitGlobalConverters_SHARED();\ninitGlobalConverters_GENERIC();\n\nconst debug = debug_(\"r2:shared#test\");\n\n// ==========================\n\nasync function fn() {\n    return Promise.resolve(\"foo\");\n}\ntest(\"dummy async test\", async (t) => {\n    debug(\"test ASYNC\");\n    t.is(await fn(), \"foo\");\n});\n\n// ==========================\n\ntest(\"SMIL clock values\", (t) => {\n    t.plan(16);\n\n    t.is(timeStrToSeconds(\"12.345\"), 12.345);\n    t.is(timeStrToSeconds(\"2345ms\"), 2.345);\n    t.is(timeStrToSeconds(\"345ms\"), 0.345);\n    t.is(timeStrToSeconds(\"7.75h\"), 27900);\n    t.is(timeStrToSeconds(\"76.2s\"), 76.2);\n    t.is(timeStrToSeconds(\"00:56.78\"), 56.78);\n    t.is(timeStrToSeconds(\"09:58\"), 598);\n    t.is(timeStrToSeconds(\"09.5:58\"), 628);\n    t.is(timeStrToSeconds(\"0:00:04\"), 4);\n    t.is(timeStrToSeconds(\"0:05:01.2\"), 301.2);\n    t.is(timeStrToSeconds(\"124:59:36\"), 449976);\n    t.is(timeStrToSeconds(\"5:34:31.396\"), 20071.396);\n    t.is(timeStrToSeconds(\"5:34.5:31.396\"), 20101.396);\n\n    t.is(timeStrToSeconds(\"7.5z\"), 7.5);\n    t.is(timeStrToSeconds(\"4:5:34:31.396\"), 0);\n    t.is(timeStrToSeconds(\"\"), 0);\n});\n\n// ==========================\n\nasync function delay(okay: boolean): Promise<boolean> {\n    return new Promise((resolve, _reject) => {\n        setTimeout(() => {\n            resolve(okay);\n        }, 1000);\n    });\n}\n\ntest(\"EPUB parsing (de)serialize roundtrip\", async (t) => {\n\n    const dirPath = path.join(process.cwd(), \"misc/epubs/\");\n\n    const filePaths: string[] = await filehound.create()\n        .discard(\"node_modules\")\n        .depth(5)\n        .paths(dirPath)\n        .ext([\".epub\", \".epub3\"])\n        .find();\n\n    for (const filePath of filePaths) {\n        debug(\"------------------------\");\n        debug(filePath);\n        // debug(\"------------------------\");\n\n        let pub: Publication;\n        try {\n            pub = await PublicationParsePromise(filePath);\n        } catch (err) {\n            console.log(err);\n            continue;\n        }\n        const publicationJson1 = TAJSON.serialize(pub);\n        const publication = TAJSON.deserialize<Publication>(publicationJson1, Publication);\n        const publicationJson2 = TAJSON.serialize(publication);\n\n        const str1 = JSON.stringify(publicationJson1, null, 2);\n        const str2 = JSON.stringify(publicationJson2, null, 2);\n\n        if (str1 !== str2) {\n            process.stdout.write(\"###########################\\n\");\n            process.stdout.write(\"###########################\\n\");\n            process.stdout.write(\"#### JSON DIFF\\n\");\n            process.stdout.write(jsonDiff.diffString(publicationJson1, publicationJson2) + \"\\n\");\n            process.stdout.write(\"###########################\\n\");\n            process.stdout.write(\"###########################\\n\");\n\n            t.true(await delay(false));\n            return;\n        }\n    }\n\n    t.true(await delay(true));\n});\n"]}